# BAM
A CLI for initializing projects and running Docker commands

## What Bam Does

Bam is an ECMAScript command line application which wraps [docker-compose](https://docs.docker.com/compose/reference/) commands.

It allows you to specify an environment (dev/test/prod) to run the container in. Bam will then use the correct docker-compose file based on your environment selection.

* If you select the `test` environment then Bam will look for `docker-compose.test.yml` in your applications root directory.
* If you select the `dev` environment then Bam will look for `docker-compose.development.yml` in your applications root directory.

Bam allows you to use the service names for your applications, the names defined in your docker-compose file, vs. the container names, the names generated by Docker.

Bam automatically inserts common docker-compose command line arguments so you don't have to, such as ensuring that you always run containers in detached mode and that one time test containers are removed.

Bam will allow you to add any supported docker-compose flags to the underlining docker-compose command, such as `bam log --tail=15 my-service`, where `--tail` is a flag for the docker-compose command [logs](https://docs.docker.com/compose/reference/logs/).

## How to use Bam

Bam can be executed via the `bam` command. There is no need to pipe bam into node as `bam` is a shell script that will run the bam ECMAScript via Node automatically.
Bam has a set number of commands you can use to execute different actions on the docker-compose services (`bam [COMMAND] [SERVICE]`).

For most commands you need to provide the environment you want to execute the command against. That is, do you want to bring up the container in *test* mode and execute said action against it or do you want to bring it up in *development* mode. To select the environment to act against, you need to  provide an _environment flag_.

* To select `test` mode use `--test`; this will use the `docker-compose.yml` and `docker-compose.test.yml` files
* To select `development` mode use `--dev`; this will use the `docker-compose.yml` and `docker-compose.development.yml` files
* To select `production` mode use `--prod`; this will just use the `docker-compose.yml` file

**Note**: If you are using docker-compose v2 or below Bam assumes your using the `extends` feature and thus will _only_ load one compose file (i.e. for `--dev` it will _only_ load the `docker-compose.development.yml` file). Since `extends` was deprecated in v3 in favour of letting the docker-compose CLI concatenate multiple compose files Bam loads both (i.e. `docker-compose.yml` and `docker-compose.development.yml`) if it detects the files are using v3 syntax.

If you have a custom environment, as in you have a custom docker-compose file setup such as `docker-compose.multi-site.yml`, which you want `bam` to use you can pass in the _environment_ part of the file via the `--env` flag.

* To select `test` mode use `--env=test`; this will use the `docker-compose.yml` and `docker-compose.test.yml` files
* To select `development` mode use `--env=development`; this will use the `docker-compose.yml` and `docker-compose.development.yml` files
* To select _multi-site_ mode use `--env=multi-site`; this will use the `docker-compose.yml` and `docker-compose.multi-site.yml` files

If you do not explicitly select an environment `bam` will default to `development`.
Note: The `test` and `lint` commands always default to the `test` environment.

## Developing Bam

You are welcome to submit PRs to fix issues, add new features, or just make Bam better.
Bam has a serries of automated tests and strives for a decent amount of code coverage to ensure that no changes will introduce regression issues. If you are submitting a PR make sure that the existing tests all pass and any new behaviours your PR is adding is covered by their own set of tests. To run the tests use the `npm run lint` and `npm test` commands.

### Adding a new Command

Bam is built with a plugin command architecture. To add a new command to Bam you simply need to add a new module to the `cmds` folder. Bam will automatically pick it up and add it to its repertoire.

A command module exposes a single function at its root level which satisfies the following interface:

```
module.exports = (composeFile, arguments, commandName) => {}
```

When Bam executes your command it will pass it in:
* The name of the docker-compose file to use (i.e. `docker-compose.development.yml`). This will simply be the compose file name and not path. It's expected to be in the root of the application/service you are executing against.
* An array of arguments that your command can use. Some commands expect the first argument to be the name of the application/service to execute against (e.g. `my-service`).
* The name of the command. This your command probably already knows and will likely not use but is useful for proxy commands such as the `dockerCompose` command, which needs to know which docker-compose command you want it to run.

Lastly if your command does *not* require to know what environment the user wants the command to run against, because the command only runs in one environment, think `test` command which always runs in the `test` environment, then you can mark your command as being a *fixed environment* command by attaching the `fixEnv` property to it.

```
module.exports = (_, args) => {...};
module.exports.fixEnv = true;
```

This way Bam will not attempt to validate that an environment flag was set preventing it from failing early and allowing your command to be executed.

#### Defining Help for your new command

Your command if it will support the `--help` flag should check the arguments list to see if the `--help` flag is present and if so display help text about your command while bypassing the execution of your command.

To have your command insert into the root `--help` feature which prints out all the commands bam supports, define the `summary` property on the root of your command.

```
module.exports.summary = 'List the services defined in the compose file.';
```

When the user types `bam --help`, bam will look up all its commands, and if the command has a `summary` property the command's name and summary text will be presented to the user.
